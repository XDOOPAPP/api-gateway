# =============================================================================
# FEPA API Gateway
# =============================================================================
# QUAN TRỌNG: Khởi chạy infrastructure và auth-service trước!
# cd deployment && docker-compose -f docker-compose.infra.yml up -d
# cd ../auth-service && docker-compose up -d
# =============================================================================

services:
  # API Gateway 
  api-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: fepa-api-gateway
    ports:
      - '3000:3000'
    volumes:
      - ./uploads:/app/uploads
    environment:
      - NODE_ENV=production
      - PORT=3000
      - RABBITMQ_URL=amqp://fepa:fepa123@fepa-rabbitmq:5672
      - JWT_SECRET=${JWT_SECRET:-fepa-key}
      - JWT_EXPIRATION=${JWT_EXPIRATION:-24h}
      - AUTH_SERVICE_HOST=fepa-auth-service
      - AUTH_SERVICE_PORT=3001
      - EXPENSE_SERVICE_HOST=expense-service
      - EXPENSE_SERVICE_PORT=3002
      - BUDGET_SERVICE_HOST=budget-service
      - BUDGET_SERVICE_PORT=3003
      - BLOG_SERVICE_HOST=blog-service
      - BLOG_SERVICE_PORT=3004
      - SUBSCRIPTION_SERVICE_HOST=fepa-subscription-service
      - SUBSCRIPTION_SERVICE_PORT=3005
      - NOTIFICATION_SERVICE_HOST=fepa-notification-service
      - NOTIFICATION_SERVICE_PORT=3006
      - PAYMENT_SERVICE_HOST=fepa-payment-service
      - PAYMENT_SERVICE_PORT=3101
      - OCR_SERVICE_HOST=ocr-service
      - OCR_SERVICE_PORT=3007
      - AI_SERVICE_HOST=ai-service
      - AI_SERVICE_PORT=3008
      - UPLOAD_DIR=/app/uploads
      - API_GATEWAY_URL=http://fepa-api-gateway:3000
    networks:
      - fepa-network
    restart: on-failure

networks:
  fepa-network:
    name: fepa-network
    external: true
